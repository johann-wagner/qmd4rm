{
  "hash": "d05e6982a67eae86ce42d7e910c20a8e",
  "result": {
    "engine": "knitr",
    "markdown": "# Dynamically writing text\n\nDynamically writing text can make parameterised and automatic reports come alive. Dynamic text can provide context and story to the figures reported. This text is generally used in:\n\n-   Comparing numbers across time (increase, decrease, stay the same)\n\n-   Comparing numbers to benchmarks/baselines\n\n-   Or providing context to whether a high number is a good of bad thing\n\nTo add extra flavour, approximate magnitude terminologies could be incorporated.\n\nFor instance EFSA has some guidelines for communicating approximate probability.\n\n| Probability term       | Subjective probability range |\n|:-----------------------|:-----------------------------|\n| Almost certain         | 99-100%                      |\n| Extremely likely       | 95-99%                       |\n| Very likely            | 90-95%                       |\n| Likely                 | 66-90%                       |\n| About as likely as not | 33-66%                       |\n| Unlikely               | 10-33%                       |\n| Very unlikely          | 5-10%                        |\n| Extremely unlikely     | 1-5%                         |\n| Almost impossible      | 0-1%                         |\n\n<https://multimedia.efsa.europa.eu/uncertainty-tutorial/uncertainty-communication/expressions-approximate.html>\n\nOr for comparing values, something like this could be utilised:\n\n| Term                    | Rough ratio compared to reference |\n|-------------------------|-----------------------------------|\n| Much more than          | \\> 10×                            |\n| Substantially more than | \\~ 5 – 10×                        |\n| Considerably more than  | \\~ 2 – 5×                         |\n| Somewhat more than      | \\~ 1.25 – 2×                      |\n| About the same as       | \\~ 0.80 – 1.25×                   |\n| Somewhat less than      | \\~ 0.50 – 0.80×                   |\n| Considerably less than  | \\~ 0.20 – 0.50×                   |\n| Substantially less than | \\~ 0.10 – 0.20×                   |\n| Much less than          | \\< 0.10×                          |\n\n\n\nAn example function is below, which takes from \\`get_value()\\` and provides text interpreting the sentence based on parameters. You could also add features to this function to add a pool of synonyms so the dynamic text is less repetitive.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ninterpret_sentence <- function(\n    value,                    # output of grab_value(), e.g. \"12.3%\" or \"0.12\"\n    context = NULL,           # optional text: \"of Regional quintile-1 participants\"\n    higher_is_better = TRUE,  # whether a high % is \"good\"\n    digits = 1,               # number of decimal places in printed %\n    cutpoints = c(0.05, 0.25, 0.75, 0.95) # thresholds for verbal labels)\n)\n{\n   # --- INTERNAL capitaliser ---------------------------------------------\n  ucfirst <- function(x) {\n    paste0(toupper(substr(x, 1, 1)), substr(x, 2, nchar(x)))\n  }\n  \n  # --- 1. Get numeric proportion from value -----------------------------\n  if (length(value) != 1L || is.na(value)) {\n    stop(\"interpret_pct_sentence() expects a single non-missing value.\")\n  }\n  \n  # value might be \"12.3%\", \"0.123\", 0.123, 12.3, etc.\n  if (is.character(value)) {\n    num <- as.numeric(str_extract(value, \"-?\\\\d+\\\\.?\\\\d*\"))\n  } else {\n    num <- as.numeric(value)\n  }\n  \n  if (is.na(num)) {\n    stop(\"Could not extract a numeric value from 'value'.\")\n  }\n  \n  # If looks like 0-1, treat as proportion; if >1, assume percentage (0-100)\n  p <- if (num > 1) num / 100 else num\n  \n  # --- 2. Translate proportion into qualitative phrase ------------------\n  cp <- cutpoints\n  phrase <- dplyr::case_when(\n    p <  cp[1] ~ if (higher_is_better) \"a very small proportion\" else \"almost none\",\n    p <  cp[2] ~ \"a minority\",\n    p <  cp[3] ~ \"around half\",\n    p <  cp[4] ~ \"a clear majority\",\n    TRUE       ~ if (higher_is_better) \"almost all\" else \"the vast majority\"\n  )\n  \n  # --- 3. Build percentage string ---------------------------------------\n  pct_string <- scales::percent(p, accuracy = 1 / 10^digits)\n  \n  # --- 4. Build final sentence ------------------------------------------\n  phrase_cap <- ucfirst(phrase)\n  \n  if (!is.null(context) && nzchar(context)) {\n    out <- paste0(phrase_cap, \" (\", pct_string, \") \", context, \".\")\n  } else {\n    out <- paste0(phrase_cap, \" (\", pct_string, \").\")\n  }\n  \n  out\n}\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# interpret_sentence(\n#   grab_value(df, quintile == 4 & rurality == \"Regional\", pct,\n#              unit = \"percent\", digits = 4),\n#   context = \"of Regional quintile-4 participants\", \n#   higher_is_better = FALSE,\n#   digits = 1\n# )\n```\n:::\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}